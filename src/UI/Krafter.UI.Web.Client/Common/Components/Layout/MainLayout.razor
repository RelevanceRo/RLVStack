@using Krafter.UI.Web.Client.Common.Components.DaisyUI
@using Krafter.UI.Web.Client.Infrastructure.Services
@inherits LayoutComponentBase

<div class="drawer drawer-open">
    <input id="main-drawer" type="checkbox" class="drawer-toggle" @bind="sidebarExpanded" />

    <div class="drawer-content flex flex-col">
        <!-- Header / Navbar -->
        <header class="w-full navbar bg-base-100 shadow-lg">
            <div class="flex-none lg:hidden">
                <label for="main-drawer" class="btn btn-square btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </label>
            </div>

            <div class="flex-none hidden lg:flex">
                <Logo Orientation="LogoOrientation.Horizontal" Size="LogoSize.ExtraSmall" />
            </div>

            <div class="flex-1 flex flex-col items-center justify-center">
                @if (IsMobileDevice == true)
                {
                    <Logo Orientation="LogoOrientation.Horizontal" Size="LogoSize.ExtraSmall" />
                }
                <span class="font-bold text-lg">@LocalAppSate.CurrentPageTitle</span>
            </div>

            <div class="flex-none flex items-center gap-2">
                @if (IsMobileDevice == false)
                {
                    <TopRight></TopRight>
                }
                <Notifications></Notifications>
                <label for="config-drawer" class="btn btn-square btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </label>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 p-4">
            <PageTitle>@LocalAppSate.CurrentPageTitle</PageTitle>
            @Body
        </main>
    </div>

    <!-- Left Sidebar (Navigation) -->
    <div class="drawer-side is-drawer-close:overflow-visible z-40 max-lg:z-50">
        <label for="main-drawer" class="drawer-overlay max-lg:block lg:hidden"></label>
        <aside class="is-drawer-close:w-20 is-drawer-open:w-80 bg-base-200 min-h-full flex flex-col">
            <AuthorizeView>
                <Authorized>
                    <!-- Logo / Brand -->
                    <div class="p-4 flex items-center justify-center lg:justify-start border-b border-base-300">
                        <div class="is-drawer-close:hidden is-drawer-open:block">
                            <Logo Orientation="LogoOrientation.Horizontal" Size="LogoSize.ExtraSmall" />
                        </div>
                        <div class="is-drawer-close:block is-drawer-open:hidden">
                            <Logo Orientation="LogoOrientation.Vertical" Size="LogoSize.ExtraSmall" />
                        </div>
                    </div>

                    <!-- Search (hidden when drawer closed) -->
                    <div class="p-4 is-drawer-close:hidden">
                        <input type="search"
                               class="input w-full"
                               placeholder="Find items..."
                               value="@searchTerm"
                               @oninput="@FilterPanelMenu" />
                    </div>

                    <!-- Menu -->
                    <div class="overflow-y-auto flex-1">
                        <ul class="menu w-full">
                            @foreach (var category in menus)
                            {
                                @if (HasPermission(category) || (category.Children != null && HasChildPermission(category)))
                                {
                                    <li class="is-drawer-close:tooltip is-drawer-close:tooltip-right" data-tip="@category.Name">
                                        <a href="@category.Path" class="gap-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                            </svg>
                                            <span class="is-drawer-close:hidden">@category.Name</span>
                                        </a>
                                    </li>
                                }
                            }
                        </ul>
                    </div>

                    <!-- Toggle Button -->
                    <div class="p-2 border-t border-base-300">
                        <label for="main-drawer" class="btn btn-ghost btn-circle w-full is-drawer-open:rotate-y-180 is-drawer-close:tooltip is-drawer-close:tooltip-right" data-tip="Expand">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z M9 4v16 M14 10l2 2l-2 2" />
                            </svg>
                        </label>
                    </div>
                </Authorized>
            </AuthorizeView>
        </aside>
    </div>
</div>

<!-- Right Sidebar (Configuration) -->
<div class="drawer drawer-end @(configSidebarExpanded ? "drawer-open" : "")" style="position: fixed; top: 0; right: 0; height: 100vh; width: 100%; pointer-events: @(configSidebarExpanded ? "auto" : "none"); z-index: 50;">
    <input id="config-drawer" type="checkbox" class="drawer-toggle" @bind="configSidebarExpanded" />
    <div class="drawer-side" style="pointer-events: auto;">
        <label for="config-drawer" class="drawer-overlay" @onclick="HandleCloseConfig"></label>
        <aside class="bg-base-200 w-96 min-h-full p-4">
            <div class="flex flex-row items-center justify-between mb-6">
                <h2 class="text-xl font-bold m-0">Demos Configuration</h2>
                <RlvButton Style="Krafter.UI.Web.Client.Common.Components.DaisyUI.ButtonStyle.Ghost"
                           Size="Krafter.UI.Web.Client.Common.Components.DaisyUI.ButtonSize.Small"
                           OnClick="HandleCloseConfig">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </RlvButton>
            </div>

            <div class="flex flex-row items-center justify-between gap-2 mt-6">
                <TopRight ShowProfileCard="true"></TopRight>
            </div>

            <div class="flex flex-row items-center justify-between gap-2 mt-6">
                <p class="text-base font-semibold m-0">Theme Preference</p>
            </div>

            <div class="flex flex-col items-start gap-2 mt-2">
                @foreach (var pref in new[] {
                    (ThemeManager.ThemePreference.Auto, "Auto (System)"),
                    (ThemeManager.ThemePreference.Light, "Light"),
                    (ThemeManager.ThemePreference.Dark, "Dark")
                })
                {
                    <label class="flex items-center gap-2 cursor-pointer">
                        <RlvRadio Name="themePreference"
                                  RadioValue="@pref.Item1.ToString()"
                                  @bind-Value="themePreferenceStr"
                                  Color="RadioColor.Primary" />
                        <span>@pref.Item2</span>
                    </label>
                }
            </div>
        </aside>
    </div>
</div>

@if (!rendered)
{
    <div class="rz-app-loading">
        <div class="logo-loading"></div>
    </div>
}

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>
