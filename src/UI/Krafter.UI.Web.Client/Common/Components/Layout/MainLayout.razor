@using Krafter.UI.Web.Client.Common.Components.DaisyUI
@using Krafter.UI.Web.Client.Infrastructure.Services
@inherits LayoutComponentBase

<div class="drawer lg:drawer-open">
    <input id="main-drawer" type="checkbox" class="drawer-toggle" @bind="sidebarExpanded" />

    <div class="drawer-content flex flex-col">
        <!-- Header / Navbar -->
        <header class="w-full navbar bg-base-100 shadow-lg">
            <div class="flex-none lg:hidden">
                <label for="main-drawer" class="btn btn-square btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </label>
            </div>

            <div class="flex-none hidden lg:flex">
                <Logo Orientation="LogoOrientation.Horizontal" Size="LogoSize.ExtraSmall" />
            </div>

            <div class="flex-1 flex flex-col items-center justify-center">
                @if (IsMobileDevice == true)
                {
                    <Logo Orientation="LogoOrientation.Horizontal" Size="LogoSize.ExtraSmall" />
                }
                <span class="font-bold text-lg">@LocalAppSate.CurrentPageTitle</span>
            </div>

            <div class="flex-none flex items-center gap-2">
                @if (IsMobileDevice == false)
                {
                    <TopRight></TopRight>
                }
                <Notifications></Notifications>
                <label for="config-drawer" class="btn btn-square btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </label>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 p-4">
            <PageTitle>@LocalAppSate.CurrentPageTitle</PageTitle>
            @Body
        </main>
    </div>

    <!-- Left Sidebar (Navigation) -->
    <div class="drawer-side z-40">
        <label for="main-drawer" class="drawer-overlay"></label>
        <aside class="bg-base-200 w-80 min-h-full">
            <AuthorizeView>
                <Authorized>
                    <div class="p-4">
                        <input type="search"
                               class="input input-bordered w-full"
                               placeholder="Find items..."
                               value="@searchTerm"
                               @oninput="@FilterPanelMenu" />
                    </div>
                    <div class="overflow-y-auto flex-1">
                        <RlvMenu Class="w-full">
                            @foreach (var category in menus)
                            {
                                if (category.Children != null && category.Children.Count() > 0 && (HasChildPermission(category)))
                                {
                                    <NavigationItem @key=category @bind-Expanded=@category.Expanded Example=@category>
                                        @if (category.Children != null && category.Children.Count() > 0)
                                        {
                                            @foreach (var menu in category.Children)
                                            {
                                                if (menu.Children != null && menu.Children.Count() > 0 && HasChildPermission(menu))
                                                {
                                                    <NavigationItem @key=menu @bind-Expanded=@menu.Expanded Example=@menu>
                                                        @foreach (var child in menu.Children)
                                                        {
                                                            if (HasPermission(menu))
                                                            {
                                                                <NavigationItem @key=child @bind-Expanded=@child.Expanded Example=@child />
                                                            }
                                                        }
                                                    </NavigationItem>
                                                }
                                                else if (HasPermission(menu))
                                                {
                                                    <NavigationItem @key=menu @bind-Expanded=@menu.Expanded Example=@menu />
                                                }
                                            }
                                        }
                                    </NavigationItem>
                                }
                                else if (HasPermission(category))
                                {
                                    <NavigationItem @key=category @bind-Expanded=@category.Expanded Example=@category></NavigationItem>
                                }
                            }
                        </RlvMenu>
                    </div>
                </Authorized>
            </AuthorizeView>
        </aside>
    </div>
</div>

<!-- Right Sidebar (Configuration) -->
<div class="drawer drawer-end @(configSidebarExpanded ? "drawer-open" : "")" style="position: fixed; top: 0; right: 0; height: 100vh; width: 100%; pointer-events: @(configSidebarExpanded ? "auto" : "none"); z-index: 50;">
    <input id="config-drawer" type="checkbox" class="drawer-toggle" @bind="configSidebarExpanded" />
    <div class="drawer-side" style="pointer-events: auto;">
        <label for="config-drawer" class="drawer-overlay" @onclick="HandleCloseConfig"></label>
        <aside class="bg-base-200 w-96 min-h-full p-4">
            <div class="flex flex-row items-center justify-between mb-6">
                <h2 class="text-xl font-bold m-0">Demos Configuration</h2>
                <RlvButton Style="Krafter.UI.Web.Client.Common.Components.DaisyUI.ButtonStyle.Ghost"
                           Size="Krafter.UI.Web.Client.Common.Components.DaisyUI.ButtonSize.Small"
                           OnClick="HandleCloseConfig">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </RlvButton>
            </div>

            <div class="flex flex-row items-center justify-between gap-2 mt-6">
                <TopRight ShowProfileCard="true"></TopRight>
            </div>

            <div class="flex flex-row items-center justify-between gap-2 mt-6">
                <p class="text-base font-semibold m-0">Theme Preference</p>
            </div>

            <div class="flex flex-col items-start gap-2 mt-2">
                @foreach (var pref in new[] {
                    (ThemeManager.ThemePreference.Auto, "Auto (System)"),
                    (ThemeManager.ThemePreference.Light, "Light"),
                    (ThemeManager.ThemePreference.Dark, "Dark")
                })
                {
                    <label class="flex items-center gap-2 cursor-pointer">
                        <RlvRadio Name="themePreference"
                                  RadioValue="@pref.Item1.ToString()"
                                  @bind-Value="themePreferenceStr"
                                  Color="RadioColor.Primary" />
                        <span>@pref.Item2</span>
                    </label>
                }
            </div>
        </aside>
    </div>
</div>

@if (!rendered)
{
    <div class="rz-app-loading">
        <div class="logo-loading"></div>
    </div>
}

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>
